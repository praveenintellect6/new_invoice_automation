<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Invoice PDF Extraction Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="static\style.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #e6f0ff;
      color: #333;
    }

    header {
      background-color: #004aad;
      color: white;
      padding: 15px;
      font-size: 1.3rem;
      font-weight: bold;
      text-align: center;
    }

    .dashboard {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 220px;
      background-color: #002f6c;
      color: white;
      display: flex;
      flex-direction: column;
      padding-top: 20px;
    }

    .sidebar button {
      background: none;
      border: none;
      color: white;
      padding: 12px 20px;
      text-align: left;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
    }

    .sidebar button:hover,
    .sidebar button.active {
      background-color: #004aad;
    }

    .main-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .submit-button {
      padding: 10px 20px;
      background-color: #004aad;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .submit-button:hover {
      background-color: #003380;
    }
  </style>
</head>

<body>
  <div id="app">
    <header>Invoice PDF Extraction</header>

    <div class="dashboard" >
      <!-- Sidebar Navigation -->
      <div class="sidebar">
        
        <button :class="{active: activeTab==='excel'}" @click="activeTab='excel'">
            <i class="fas fa-file-excel"></i> Upload Excel
        </button>

        <button :class="{active: activeTab==='pdf'}" @click="activeTab='pdf'">
            <i class="fas fa-file-pdf"></i> Upload PDF
        </button>

        <!-- <button :class="{active: activeTab==='invoices'}" @click="activeTab='invoices'">
          <i class="fas fa-table"></i> Show Invoices
        </button> -->
        <button :class="{active: activeTab==='month'}" @click="activeTab='month'">
            <i class="fas fa-calendar-alt"></i> Month Report
        </button>

        <button :class="{active: activeTab==='settings'}" @click="activeTab='settings'">
            <i class="fas fa-cog"></i> Settings
        </button>

        <button :class="{active: activeTab==='add_new_supplier'}" @click="activeTab='add_new_supplier'">
            <i class="fas fa-building"></i> Add New Supplier
        </button>

        <button :class="{active: activeTab==='edit_case'}" @click="activeTab='edit_case'">
            <i class="fas fa-tools"></i> Edit Case
        </button>

        <button :class="{active: activeTab==='column_mapping'}" @click="activeTab='column_mapping'">
            <i class="fas fa-exchange-alt"></i> Column Mapping
        </button>

    </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Upload Excel -->
        <div v-if="activeTab==='excel'">
          <h4>Upload Excel Files</h4>
          <input type="date" v-model="corr_date" class="form-control w-50 mb-3">
          <input type="file" multiple accept=".xlsx" @change="handleFileUpload" />
          <button @click="submitFiles" class="submit-button mt-2">Upload Excel</button>
        </div>

        <!-- Upload PDF -->
        <div v-if="activeTab==='pdf'">
          <h4>Upload PDF Files</h4>
          <input type="date" v-model="corr_date" class="form-control w-50 mb-3">
          <input type="file" multiple accept="application/pdf" @change="handlepdfFiles" />
          <button @click="submitpdfFiles" class="submit-button mt-2">Upload PDF</button>
        </div>

        <!-- Invoice Table -->
        <div v-if="activeTab==='invoices'">
          <h4>Invoice List</h4>
          <table v-if="invoice_list.length" class="table table-bordered">
            <thead class="table-dark">
              <tr>
                <th v-for="(val, key) in invoice_list[0]" :key="key">[[ key ]]</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(row, i) in invoice_list" :key="i">
                <td v-for="(val, key) in row" :key="key+i">[[ val ]]</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Month Report -->
        <div v-if="activeTab==='month'">
          <h4>Download Month Report</h4>
          <!-- <form @submit.prevent="submitMonth" class="d-flex align-items-center gap-3">
            <input type="month" v-model="selectedMonth" class="form-control w-25">
            <button type="submit" class="submit-button">Download</button>
          </form> -->
        </div>

        <!-- add_new_supplier  -->
        <div v-if="activeTab==='add_new_supplier'">
          <h4>add_new_supplier</h4>
              {% include "add_supplier.html" %}
        </div>

        <!-- edit_case -->
        <div v-if="activeTab==='edit_case'">
          <h4>edit_case</h4>
          
        </div>

        <!-- column_mapping -->
        <div v-if="activeTab==='column_mapping'">
          <h4>column_mapping</h4>
            
        </div>

        <!-- Settings -->
        <div v-if="activeTab==='settings'">
         
        </div>
        
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;
    createApp({
      delimiters: ['[[', ']]'],
      data() {
        return {
        //  main page variables--------------------------
        activeTab: 'excel',
        invoice_list: [],
        files: [],
        pdfFiles: [],
        corr_date: "",
        selectedMonth: "",
        //  editcase  variables-------------------------
        suppliers:[],
        selectedSupplier:'',
        case_table_body:[],
        newCase: {
            supplier_id:"",
            minvalue: "",
            maxvalue: "",
            actual_price: "",
            profit: "",
            selling_price_exc_gst: "",
            gst: "",
            selling_price_inc_gst: ""
            },
        // column Mapping variables---------------------
        selectedSupplierColumn:'',
        colMap:[],
        colMapFul:[],
        ColCase:{
            supplierid:'',
            supplier_col:'',
            date_col:'',
            part_description_col:'',
            part_number_col:'',
            trade_price_col:'',
            total_count_col:'',
            purchase_count_col:'',
            total_price_col:'',
            actual_price_col:'',
            profit_col:'',
            selling_price_exc_gst_col:'',
            gst_col:'',
            selling_price_inc_gst_col:'',
        },
        // add new supplier valiables--------------------
        supplier_name:'',
        supplier_delete:'',
        };
      },
    methods:{
          // add new supplier functions--------------------
        async supplierDelete(){
            const baseUrl = window.location.origin;
            const response = await axios.post(`${baseUrl}/delete_supplier/`,new URLSearchParams({supplier_id : this.supplier_delete}),
                {
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                    }
                }
            );
            if (response.data.status === 'success')
            {
              alert("Supplier Deleted successfully!");
               this.fetch_supplier(); 
            }
            else{
              alert("Error!");
            }
        },

        async addNewSupplier(){
          const baseUrl = window.location.origin;
          const response = await axios.post(
              `${baseUrl}/add_supplier/`,new URLSearchParams({supplier_name : this.supplier_name}),
                {
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                    }
                }
            );
            if (response.data.status === 'success')
            {
              alert("Supplier added successfully!");
              this.fetch_supplier(); 
            }
           else {
               alert("error!");
            }
        },

        async fetch_supplier(){
             try{
                    const baseUrl = window.location.origin;
                    const response = await axios.get(`${baseUrl}/get_suppliers/`);
                    this.suppliers = response.data;

                } catch (error) {
                    console.error("Error fetching suppliers:", error);
                }
        },
      },
    mounted() {
        this.fetch_supplier(); 
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        this.selectedMonth = `${year}-${month}`;

      },
    }).mount("#app");
  </script>
</body>
</html>
